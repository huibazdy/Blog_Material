# new



## new 一个对象





## new 动态数组

C++ 和标准库提供了两种一次分配一个对象数组的方法，一种是通过 new 另一种是通过标准库中的 allocator 类。

### 分配

1. 指明数组类型和分配数量

    ```c++
    // 用 new 运算符来分配一个整型动态数组
    
    int *ptr = new int[10];
    ```

2. 使用数组类型别名来分配

    ```c++
    typedef int arr[100];   // arr 表示大小为 100 个 int 的数组类型
    
    int *ptr1 = new arr;    // 分配一个大小为 100 的 int 型数组， ptr1 指向第一个元素

3. 动态分配空数组是合法的，但不能解引用

    ```c++
    int nums[0];   // 错误，不能定义长度为 0 的数组
    int *p = new int[0];  // 正确，但 p 不能解引用



> 分配一个动态数组，会得到一个元素类型的指针



### 释放

释放使用 `delete` 的特殊用法，在其后加上一个空的方括号：

```c++
int *p = new int[100];
...
delete [] p;
```

需要注意的是，如果使用类型别名来定义数组时，方括号也是必须的：

```c++
typedef int Array[10];
int *p1 = new Array;
...
delete [] p1;
```



## 智能指针与动态数组

标椎库提供了 `unique_ptr` 来管理 new 分配的动态数组

```c++
unique_ptr<int[]> up(new int[10]);  // up 指向一个包含未初始化长度为 10 的整型数组
up.release();                       // 自动用 delete [] 来销毁其指针
```

类型说明符（`<>`）中的`int[]`说明 up 指向的是一个数组而不是一个 int 。

注意：

1. 当一个 unique_ptr 指向数组时，不能用点或箭头运算符访问数组元素成员，因为它指向的是数组而不是单个对象；
2. 可以用下标运算符来访问数组元素

> 注意：`shared_ptr` 不支持管理动态数组。